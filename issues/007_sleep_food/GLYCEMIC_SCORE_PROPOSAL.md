# 血糖値スコア作成の提案と実現可能性評価

**作成日**: 2026-02-02

---

## 🎯 血糖値スコアの目的

1日の栄養素摂取パターンから**血糖値への影響を推定するスコア**を作成し、睡眠の質との関係を分析する。

---

## 📊 現在のデータ状況

### 利用可能なデータ

1. **nutrition.csv** (26日分):
   - 日次集計: calories, carbs, fat, fiber, protein, sodium, water
   - **制限**: 詳細な栄養素情報がない（糖質の種類、GI値など）

2. **food_logs.csv** (2日分のみ):
   - 食品名、食事タイミング（mealTypeId）、カロリー
   - **制限**: protein, fat, carbs, fiber, sodiumがすべて空欄

3. **sleep.csv** + **heart_rate データ**:
   - 睡眠指標、心拍数指標

### データの課題

❌ **food_logs.csvの詳細栄養素が欠損**
- protein, fat, carbs, fiberがすべて空欄
- Fitbit APIから詳細データを取得できていない可能性

---

## 💡 血糖値スコアの設計案

### 方法1: 既存のnutrition.csvベース【実装可能】

**利用可能なデータ**:
- 炭水化物総量 (carbs)
- 食物繊維 (fiber)
- タンパク質 (protein)
- 脂質 (fat)

**計算式**: グリセミック負荷（GL）の簡易版

```
血糖値インパクトスコア (GIS) = (carbs - fiber) × 修正係数

修正係数 = 1.0 - (protein_ratio × 0.3) - (fat_ratio × 0.2)
```

**根拠**:
1. **正味炭水化物 (Net Carbs)**: 炭水化物から食物繊維を引く
   - 食物繊維は血糖値を上昇させない

2. **タンパク質効果**: タンパク質は炭水化物の吸収を緩やかにする
   - 修正係数で最大30%減

3. **脂質効果**: 脂質も炭水化物の吸収を遅らせる
   - 修正係数で最大20%減

**スコアの解釈**:
- **低 (< 80)**: 血糖値への影響が少ない → 安定した睡眠が期待される
- **中 (80-120)**: 中程度の血糖値変動
- **高 (> 120)**: 血糖値の急上昇・急降下のリスク → 睡眠の質に悪影響

### 方法2: 食品データベース活用【やや複雑】

**food_logs.csvの食品名から外部データベースでGI値を推定**

1. 食品名をパース（例: "えんばく(オートミール)(40g)" → "オートミール"）
2. GI値データベースと照合（シドニー大学のGIデータベースなど）
3. 各食品のグリセミック負荷を計算
4. 1日の合計GLを算出

**課題**:
- 日本語食品名の正規化が必要
- GI値データベースの整備が必要
- データが2日分しかない

### 方法3: 食事タイミングスコア【補助的】

**mealTypeIdを活用して食事タイミングの影響を評価**

```
タイミングスコア = 夕食の炭水化物量 × 就寝時刻までの時間
```

- 就寝直前の炭水化物摂取 → スコアが高い → 睡眠への影響大

---

## ✅ 推奨アプローチ

### 短期的（すぐ実装可能）

**方法1の血糖値インパクトスコア (GIS) を実装**

**メリット**:
- 既存のnutrition.csvだけで計算可能（26日分）
- 科学的根拠がある
- 実装が簡単

**分析内容**:
1. 日次GISを計算
2. GISと睡眠指標の相関分析
3. GISと心拍数指標（ディップ率など）の相関分析
4. GISをカテゴリ分け（低/中/高）して睡眠を比較

**期待される発見**:
- 低GIS日 → 深い睡眠、高ディップ率
- 高GIS日 → 浅い睡眠、低ディップ率、覚醒回数増加

### 中期的（データ蓄積後）

**food_logs.csvの詳細データ取得を改善**

1. Fitbit APIの設定確認
2. 食品ごとの栄養素データを取得
3. 方法2（GI値ベース）を実装
4. 食事タイミングの影響を分析

---

## 🔬 科学的根拠

### 血糖値変動と睡眠の関係

**既存研究**:

1. **高GI食と睡眠**:
   - 高GI炭水化物 → 血糖スパイク → インスリン急上昇 → 低血糖 → 覚醒
   - 低GI炭水化物 → 安定した血糖値 → 深い睡眠

2. **食物繊維の効果**:
   - 食物繊維 → 炭水化物の吸収を緩やかに → 血糖値安定
   - 今回の分析でも食物繊維と深い睡眠に正の相関

3. **タンパク質と脂質の効果**:
   - 食事にタンパク質・脂質を含む → 炭水化物単独より血糖値の上昇が緩やか
   - 「セカンドミール効果」: 朝食の内容が昼食後の血糖値にも影響

### 夜間低血糖と睡眠の質

- 夕食で高GI食 → 夜間に低血糖 → ストレスホルモン放出 → 覚醒
- 夕食でタンパク質・脂質・食物繊維を十分に → 夜間の血糖値安定 → 良好な睡眠

---

## 📊 実装例

### GISの計算ロジック（Python）

```python
def calc_glycemic_impact_score(carbs, fiber, protein, fat, calories):
    """
    血糖値インパクトスコア (GIS) を計算

    Parameters
    ----------
    carbs : float
        炭水化物 (g)
    fiber : float
        食物繊維 (g)
    protein : float
        タンパク質 (g)
    fat : float
        脂質 (g)
    calories : float
        総カロリー (kcal)

    Returns
    -------
    float
        血糖値インパクトスコア
    """
    # 正味炭水化物
    net_carbs = max(0, carbs - fiber)

    # タンパク質・脂質の比率
    protein_ratio = min(protein / calories * 9, 0.3)  # 最大30%減
    fat_ratio = min(fat / calories * 9, 0.2)  # 最大20%減

    # 修正係数
    modifier = 1.0 - protein_ratio - fat_ratio

    # GIS
    gis = net_carbs * modifier

    return gis


def categorize_gis(gis):
    """GISをカテゴリに分類"""
    if gis < 80:
        return "低 (良好)"
    elif gis < 120:
        return "中"
    else:
        return "高 (注意)"
```

### 分析スクリプトの例

```python
# GISを計算
df['gis'] = df.apply(
    lambda row: calc_glycemic_impact_score(
        row['carbs'], row['fiber'],
        row['protein'], row['fat'], row['calories']
    ), axis=1
)

# カテゴリ分け
df['gis_category'] = df['gis'].apply(categorize_gis)

# 睡眠指標との相関
correlations = df[['gis', 'sleep_minutes', 'deep_minutes',
                    'sleep_efficiency', 'dip_rate']].corr()

# カテゴリ別の睡眠比較
category_stats = df.groupby('gis_category')[
    ['sleep_minutes', 'deep_minutes', 'sleep_efficiency', 'dip_rate']
].mean()
```

---

## 🎯 期待される分析結果

### 仮説

1. **低GIS → 良好な睡眠**
   - 深い睡眠が長い
   - 睡眠効率が高い
   - ディップ率が高い（良好な回復）
   - 覚醒回数が少ない

2. **高GIS → 睡眠の質低下**
   - 浅い睡眠が多い
   - 睡眠中の覚醒が増える
   - ディップ率が低い
   - 心拍数が不安定

3. **PFCバランスの重要性**
   - 同じ炭水化物量でも、タンパク質・脂質・食物繊維が多い → GISが低い → 睡眠の質が良い

---

## 📈 実装の優先度

### 優先度1: すぐ実装すべき【推奨】

✅ **方法1の血糖値インパクトスコア (GIS)**
- 既存データで即座に実装可能
- 26日分のデータで有意義な分析が可能
- 科学的根拠がある

### 優先度2: データ改善後

⚠️ **food_logs.csvの詳細データ取得**
- Fitbit APIの設定を確認
- 栄養素データが取得できるようになったら方法2を実装

### 優先度3: 将来的な拡張

🔮 **高度な分析**
- 食事タイミング（朝/昼/夕）別のGIS
- 連続グルコースモニター (CGM) データとの統合（可能な場合）
- 個人の血糖値反応をモデル化（十分なデータが集まったら）

---

## 💬 結論

### 質問への回答

> データ数は少ないんだが、たとえば１日の栄養素から血糖値スコアみたいなものをつくって評価すると、役に立つか？

**回答**: ✅ **はい、非常に役に立つと思います！**

**理由**:

1. **26日分のデータは分析に十分**
   - 相関分析には20-30サンプルで有意な結果が得られる
   - すでに食物繊維やタンパク質との相関が見つかっている

2. **既存データだけで実装可能**
   - nutrition.csvの情報から血糖値インパクトスコアを計算できる
   - 追加のデータ収集が不要

3. **科学的根拠が強い**
   - 血糖値変動と睡眠の関係は多数の研究で確立されている
   - 食物繊維・タンパク質・脂質の効果は既知

4. **実践的な示唆が得られる**
   - どのような食事パターンが睡眠に良いか具体的に分かる
   - PFCバランスの重要性が定量化できる

### 次のステップ

1. **血糖値インパクトスコア (GIS) の実装** ← 最優先
2. **GISと睡眠指標の相関分析**
3. **GISと心拍数回復の相関分析**
4. **実践的な食事パターン推奨の作成**

---

*Generated: 2026-02-02*
